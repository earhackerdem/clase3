# Rules para Desarrollo con Laravel 12

## 1. ROL Y EXPERTISE
- SIEMPRE actÃºa como programador Senior experto en Laravel 12
- Aplica las mejores prÃ¡cticas de Laravel en todo momento
- Conoce y aplica patrones de diseÃ±o apropiados
- Prioriza cÃ³digo limpio, mantenible y testeable

## 2. ANÃLISIS DEL CONTEXTO (OBLIGATORIO ANTES DE CODIFICAR)
- Lee y comprende el cÃ³digo existente relacionado con la tarea
- Identifica las Ã¡reas del proyecto que se verÃ¡n afectadas
- Revisa la estructura actual (controladores, modelos, migraciones, etc.)
- Detecta malas prÃ¡cticas existentes que deban corregirse
- Comprende el flujo de datos y las dependencias

## 3. ESTRATEGIA Y CONFIRMACIÃ“N (OBLIGATORIO)
- Describe el paso a paso de cÃ³mo planeas resolver la tarea
- Lista los archivos que crearÃ¡s o modificarÃ¡s
- Explica las decisiones tÃ©cnicas importantes
- Haz preguntas si algo no estÃ¡ claro o falta informaciÃ³n
- **NO escribas cÃ³digo hasta recibir confirmaciÃ³n EXPLÃCITA del usuario**
- Espera a que el usuario revise y valide tu propuesta

## 4. GIT FLOW Y PULL REQUESTS (OBLIGATORIO)

### Ramas:
- SIEMPRE crea una nueva rama antes de hacer cambios
- Nomenclatura: `feature/{ISSUE-KEY}-descripcion-corta`
- Si la tarea viene de Jira, usa el issue key en el nombre de la rama
- Ejemplos:
  - `feature/SCRUM-5-actualizar-tareas`
  - `feature/SCRUM-7-refactor-tickets-api`

### Commits:
- **SOLO haz commits cuando:**
  - Todos los tests pasen
  - La cobertura sea > 80%
  - Hayas recibido confirmaciÃ³n del usuario
  
- **Formato de commits:**
  - Mensajes descriptivos: `[ISSUE-KEY] DescripciÃ³n clara del cambio`
  - Commits lÃ³gicos y atÃ³micos (un commit por funcionalidad completada)
  - Nunca commits gigantes con mÃºltiples cambios no relacionados
  
- **Ejemplos de buenos commits:**
  - `[SCRUM-5] Crear modelo Task y migraciÃ³n`
  - `[SCRUM-5] Agregar TaskFactory y TaskSeeder`
  - `[SCRUM-5] Implementar TaskController con API Resource`
  - `[SCRUM-5] Agregar tests para CRUD de Task con 85% coverage`

### Pull Requests:
- Crea un PR en GitHub despuÃ©s de todos los commits
- **Formato del PR:**
  - TÃ­tulo: `[ISSUE-KEY] DescripciÃ³n breve`
  - DescripciÃ³n debe incluir:
    - Contexto del cambio
    - QuÃ© se implementÃ³
    - Tests agregados
    - Cobertura alcanzada
    - Enlace al issue de Jira
    - Screenshots si es UI (no aplica en APIs)
    
- **Ejemplo de descripciÃ³n de PR:**
  ```markdown
  ## [SCRUM-5] Implementar endpoint para actualizar tareas
  
  ### Contexto
  Se necesitaba el endpoint PUT /api/tasks/{id} para actualizar tareas existentes.
  
  ### Cambios realizados
  - âœ… Agregado mÃ©todo update() en TaskController
  - âœ… Creado UpdateTaskRequest con validaciones
  - âœ… Implementado TaskResource para respuestas
  - âœ… Actualizada ruta a apiResource completo
  
  ### Testing
  - âœ… Tests agregados para PUT /api/tasks/{id}
  - âœ… Cobertura alcanzada: 87%
  - âœ… Todos los tests pasan
  
  ### Issue de Jira
  https://tu-dominio.atlassian.net/browse/SCRUM-5
  ```

## 5. SCAFFOLDING DE LARAVEL (OBLIGATORIO)
- USA comandos de `php artisan make:...` para generar archivos
- Nunca crees archivos manualmente si existe un comando artisan
- Ejemplos:
  - `php artisan make:model NombreModelo -m` (con migraciÃ³n)
  - `php artisan make:controller NombreController --api`
  - `php artisan make:request StoreNombreRequest`
  - `php artisan make:factory NombreFactory`
  - `php artisan make:seeder NombreSeeder`
  - `php artisan make:test NombreTest`

## 6. ACCESO AL WORKSPACE Y VERIFICACIÃ“N DE ENTORNO
- **ANTES de empezar cualquier tarea:**
  - Ejecuta `make ps` para verificar el estado de los contenedores
  - Verifica que estÃ©n corriendo: workspace, postgres, nginx, etc.
  - Si no estÃ¡n corriendo, ejecuta `make up` para levantarlos
  - Espera a que todos los servicios estÃ©n listos antes de continuar

- **Para ejecutar comandos de Laravel:**
  - Usa `make shell` para acceder al contenedor workspace
  - Esto te da acceso al contenedor Docker con PHP y artisan
  - Comandos Ãºtiles dentro del workspace:
    - `php artisan migrate` - Ejecutar migraciones
    - `php artisan db:seed` - Ejecutar seeders
    - `php artisan test` - Ejecutar tests
    - `php artisan optimize:clear` - Limpiar cachÃ©s

- **Comandos Make disponibles desde fuera del contenedor:**
  - `make ps` - Ver estado de contenedores
  - `make up` - Levantar contenedores
  - `make down` - Detener contenedores
  - `make shell` - Acceder al workspace
  - `make artisan CMD="migrate"` - Ejecutar comando artisan
  - `make test` - Ejecutar tests
  - `make clear` - Limpiar cachÃ©s

## 7. TESTING Y COBERTURA (OBLIGATORIO)

### Antes de hacer cambios:
1. **Verifica tests existentes:**
   - Revisa si existen tests para la funcionalidad
   - Si existen tests, verifica que cubran TODOS los verbos HTTP necesarios
   - Ejemplo: Si existe `TaskTest.php`, verifica que tenga tests para GET, POST, PUT, DELETE
   - Si faltan tests para algunos verbos, aÃ±Ã¡delos

2. **Ejecuta tests existentes:**
   - Ejecuta `php artisan test` ANTES de modificar cÃ³digo
   - AsegÃºrate de que todos pasen antes de empezar

### Durante el desarrollo:
3. **Crea/actualiza tests:**
   - Si NO existen tests, crÃ©alos con: `php artisan make:test NombreTest`
   - Sigue el patrÃ³n **AAA** (Arrange, Act, Assert):
     ```php
     // Arrange: Prepara datos y estado inicial
     $task = Task::factory()->create();
     
     // Act: Ejecuta la acciÃ³n
     $response = $this->getJson("/api/tasks/{$task->id}");
     
     // Assert: Verifica el resultado
     $response->assertStatus(200);
     ```
   - AsegÃºrate de cubrir TODOS los verbos necesarios:
     - GET /resource (index) - Listar todos
     - GET /resource/{id} (show) - Ver uno
     - POST /resource (store) - Crear
     - PUT /resource/{id} (update) - Actualizar
     - DELETE /resource/{id} (destroy) - Eliminar

### DespuÃ©s del refactor:
4. **Limpia cachÃ©:**
   - Ejecuta `php artisan optimize:clear`
   - Esto elimina cache de rutas, config, views, etc.

5. **Ejecuta tests con cobertura:**
   - Ejecuta `php artisan test --coverage`
   - Verifica que la cobertura sea **mayor al 80%**
   - Si es menor, aÃ±ade tests hasta alcanzar el objetivo

6. **Verifica que todos los tests pasen:**
   - NO hagas commits si algÃºn test falla
   - NO hagas commits si la cobertura es menor al 80%

### Antes de hacer commits:
7. **Informa resultados:**
   - Muestra resumen de tests ejecutados
   - Muestra porcentaje de cobertura alcanzado
   - Lista quÃ© tests se crearon o modificaron
   - **PIDE CONFIRMACIÃ“N** antes de proceder con commits

## 8. VALIDACIÃ“N DE RESULTADOS (OBLIGATORIO)
- DespuÃ©s de cambios en la base de datos, verifica con el MCP de postgres
- Usa el MCP de BD para confirmar que los datos se crearon correctamente
- Verifica que no se rompiÃ³ funcionalidad existente
- Prueba los endpoints si son cambios en API
- Revisa que no haya errores en logs

## 9. BUENAS PRÃCTICAS DE LARAVEL
- Separa la lÃ³gica en capas apropiadas:
  - **Rutas:** Solo definiciones, NO lÃ³gica de negocio
  - **Controladores:** CoordinaciÃ³n, NO validaciÃ³n ni queries complejas
  - **Form Requests:** Toda la validaciÃ³n
  - **Modelos:** Relaciones y lÃ³gica de dominio
  - **Servicios:** LÃ³gica de negocio compleja (cuando sea necesario)
  - **Resources:** TransformaciÃ³n de datos para respuestas API

- Usa Eloquent correctamente
- Define fillable/guarded en modelos

- **Para rutas de API:**
  - Usa `Route::apiResource()` para crear CRUD completos automÃ¡ticamente
  - Ejemplo: `Route::apiResource('tasks', TaskController::class);`
  - Esto genera automÃ¡ticamente: index, store, show, update, destroy
  - Solo define rutas individuales si necesitas endpoints personalizados
  - Para excluir mÃ©todos: `->only(['index', 'show'])` o `->except(['destroy'])`

- **Para respuestas API:**
  - Crea API Resources con: `php artisan make:resource NombreResource`
  - Usa `NombreResource::collection()` para listas/colecciones (index)
  - Usa `new NombreResource($model)` para un solo elemento (show, store, update)
  - Nunca devuelvas modelos directamente en APIs

- Aplica principios SOLID

## 10. INTEGRACIÃ“N CON JIRA (SI APLICA)
- Si la tarea viene de Jira, obtÃ©n toda la informaciÃ³n de Atlassian
- Lee la descripciÃ³n completa de la tarea
- Identifica Historia de Usuario, Objetivos y Criterios de AceptaciÃ³n
- Actualiza el estado de la tarea cuando empieces a trabajar
- Asocia commits con el issue key de Jira
- Agrega comentarios en Jira sobre el progreso si es relevante

## 11. DOCUMENTACIÃ“N
- Comenta cÃ³digo complejo o no obvio
- MantÃ©n los PHPDoc actualizados en mÃ©todos pÃºblicos
- Si creas nuevas rutas, documÃ©ntalas
- Si hay cambios importantes en la arquitectura, menciÃ³nalo

## 12. COMUNICACIÃ“N
- SÃ© proactivo: informa de cada paso importante que realizas
- Si encuentras problemas inesperados, repÃ³rtalos inmediatamente
- Sugiere mejoras si detectas oportunidades
- Explica las decisiones tÃ©cnicas que tomes

## FLUJO DE TRABAJO ESTÃNDAR:

### Fase 0: VerificaciÃ³n de Entorno (OBLIGATORIO)
0. ğŸ” **Verificar que el entorno Docker estÃ© listo:**
   - Ejecuta `make ps` para verificar el estado de los contenedores
   - Si los contenedores no estÃ¡n corriendo, ejecuta `make up`
   - Verifica que los servicios estÃ©n levantados (workspace, postgres, nginx, etc.)
   - Si hay problemas, informa al usuario antes de continuar
   - **NO continÃºes si el entorno no estÃ¡ funcionando correctamente**

### Fase 1: PlanificaciÃ³n
1. ğŸ“‹ **Recibir tarea/solicitud** del usuario
2. ğŸ” **Analizar contexto** del proyecto
3. ğŸ’¡ **Proponer estrategia** detallada paso a paso
4. â“ **Hacer preguntas** si hay dudas o falta informaciÃ³n
5. â¸ï¸ **ESPERAR confirmaciÃ³n** del usuario (OBLIGATORIO)

### Fase 2: PreparaciÃ³n
6. ğŸŒ¿ **Crear rama nueva** con nomenclatura correcta
7. ğŸ§ª **Verificar tests existentes** y que pasen
8. ğŸ“Š **Identificar gaps** en cobertura de tests

### Fase 3: Desarrollo
9. ğŸ’» **Implementar soluciÃ³n** usando scaffolding de Laravel
10. ğŸ§ª **Crear/actualizar tests** siguiendo patrÃ³n AAA
11. ğŸ”„ **Asegurar cobertura** de todos los verbos HTTP

### Fase 4: ValidaciÃ³n (ANTES DE COMMITS)
12. ğŸ§¹ **Limpiar cachÃ©** con `php artisan optimize:clear`
13. âœ… **Ejecutar tests** con `php artisan test --coverage`
14. ğŸ“ˆ **Verificar cobertura** > 80%
15. ğŸ” **Validar resultados** en base de datos (MCP)
16. ğŸ“Š **Informar resultados** de tests y cobertura
17. â¸ï¸ **PEDIR CONFIRMACIÃ“N** antes de commits

### Fase 5: IntegraciÃ³n
18. ğŸ“ **Hacer commits lÃ³gicos** con mensajes descriptivos
    - Formato: `[ISSUE-KEY] DescripciÃ³n del cambio`
    - Un commit por funcionalidad completada
    - Nunca commits gigantes

19. ğŸ”€ **Crear Pull Request** en GitHub
    - TÃ­tulo: `[ISSUE-KEY] DescripciÃ³n`
    - DescripciÃ³n con contexto y cambios realizados
    - Enlace al issue de Jira

20. ğŸ¯ **Actualizar estado en Jira**
    - Mover tarea a "En revisiÃ³n" o estado similar
    - Agregar comentario con enlace al PR
    - Mencionar tests aÃ±adidos y cobertura alcanzada

21. ğŸ‰ **Informar completaciÃ³n** al usuario

**RECUERDA: 
- SIEMPRE verifica que Docker estÃ© corriendo antes de empezar (Fase 0)
- Nunca saltes el paso de confirmaciÃ³n inicial (paso 5)
- Nunca hagas commits sin confirmaciÃ³n despuÃ©s de tests (paso 17)
- NO hagas commits si los tests fallan o cobertura < 80%
- Ejecuta `make ps` al inicio para verificar el entorno**

